{% extends "admin_base.html" %}
{% block content %}
<h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–∑—é–º–µ</h2>

<form action="/admin/settings" method="post" class="settings-form">

    <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—é–º–µ</h3>
    <a href="/admin/export-json" class="btn-secondary">
        <i class="fas fa-file-export"></i> –°–∫–∞—á–∞—Ç—å JSON
    </a>

    <h3 class="mt-4">üì• –ò–º–ø–æ—Ä—Ç —Ä–µ–∑—é–º–µ</h3>
    <a href="/admin/import-json" class="btn-secondary" title="–ó–∞–≥—Ä—É–∑–∏—Ç–µ .json-—Ñ–∞–π–ª —Ä–µ–∑—é–º–µ">
  <i class="fas fa-file-import"></i> –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–º–ø–æ—Ä—Ç–∞
</a>

{% if json_success %}
  <p class="mt-2 text-green-600">‚úÖ {{ json_success }}</p>
{% elif json_error %}
  <p class="mt-2 text-red-600">‚ùå {{ json_error }}</p>
{% endif %}

<h3 class="mt-4 flex items-center gap-2">
    üì¶ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
    <span class="tooltip" title="–°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –±–∞–∑–∞ –∏ –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ/—Ñ–∞–π–ª—ã.">‚ùì</span>
  </h3>
<a href="/admin/backup" class="btn-secondary">
  <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ (.zip)
</a>

  <h3>üé® –®–∞–±–ª–æ–Ω –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
  <label for="template">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å:</label>
  <select name="template">
      <option value="classic" {% if info.get("template") == "classic" %}selected{% endif %}>–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π</option>
      <option value="modern" {% if info.get("template") == "modern" %}selected{% endif %}>–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π</option>
  </select>

  <hr class="my-6">

  <h3>üëÅÔ∏è –í–∏–¥–∏–º–æ—Å—Ç—å —Ä–µ–∑—é–º–µ</h3>
  <label>
    <input type="checkbox" name="visibility" value="public"
      {% if info.get("visibility", "public") == "public" %}checked{% endif %}>
    –†–µ–∑—é–º–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ
  </label><br>

  <label for="hidden_message">–°–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ —Å–∫—Ä—ã—Ç–æ:</label><br>
  <textarea name="hidden_message" rows="3" cols="60">{{ info.get("hidden_message", "") }}</textarea>

  <br><br>
  <input type="submit" value="üíæ  –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏">
</form>

<hr class="my-6">
<h3>üîê –°–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å</h3>

<form action="/admin/change-credentials" method="post">
    <label>–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å:</label><br>
    <input type="password" name="current_password" required><br><br>

    <label>–ù–æ–≤—ã–π –ª–æ–≥–∏–Ω:</label><br>
    <input type="text" name="new_username" required><br><br>

    <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label><br>
    <input type="password" name="new_password"><br><br>

    <label>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label><br>
    <input type="password" name="confirm_password"><br><br>

    <input type="submit" value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">

    {% if cred_error %}
      <p style="color: red;">{{ cred_error }}</p>
    {% elif cred_success %}
      <p style="color: green;">{{ cred_success }}</p>
    {% endif %}
</form>

<h3 class="text-lg font-semibold mt-8 mb-2">üõ° –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)</h3>

{% if admin.twofa_enabled %}
<p class="text-green-600 mb-2">2FA –≤–∫–ª—é—á–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Google Authenticator, 1Password –∏ —Ç.–ø.).</p>
{% else %}
<p class="text-yellow-600 mb-2">2FA –Ω–µ –∞–∫—Ç–∏–≤–Ω–∞. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∏–∂–µ.</p>
{% endif %}

{% if request.query_params.get("disabled_2fa") == "true" %}
<div class="bg-green-100 text-green-700 px-4 py-2 rounded mb-4 text-sm">
    2FA —É—Å–ø–µ—à–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞.
</div>
{% endif %}
{% if admin.twofa_enabled %}
<p class="text-green-600 mb-2">‚úÖ 2FA –≤–∫–ª—é—á–µ–Ω–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–∞.</p>
<form method="post" action="/admin/disable-2fa">
    <button class="btn-danger">–û—Ç–∫–ª—é—á–∏—Ç—å 2FA</button>
</form>
{% else %}

  {% if qr_base64 %}
    <img src="data:image/png;base64,{{ qr_base64 }}" alt="QR Code" class="my-2">
    <form method="post" action="/admin/enable-2fa">
      <label for="code" class="block text-sm font-medium">–ö–æ–¥ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</label>
      <input type="text" name="code" id="code" required class="w-full border rounded px-3 py-2 my-2">
      <button class="btn-primary">–í–∫–ª—é—á–∏—Ç—å 2FA</button>
    </form>
  {% endif %}
{% endif %}
{% if request.query_params.get("error") == "invalid_2fa" %}
<div class="bg-red-100 text-red-700 px-4 py-2 rounded mb-4 text-sm">
    –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ 2FA. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.
</div>
{% endif %}

<h3 class="text-lg font-semibold mt-10 mb-2">üîê –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å</h3>

<form method="post" action="/admin/change-security-question" class="space-y-4 max-w-md">
    <label for="security_question" class="block text-sm font-medium">–í–æ–ø—Ä–æ—Å</label>
    <input type="text" id="security_question" name="security_question" value="{{ admin.security_question or '' }}" class="w-full border rounded px-3 py-2">

    <label for="security_answer" class="block text-sm font-medium">–û—Ç–≤–µ—Ç</label>
    <input type="text" id="security_answer" name="security_answer" placeholder="(–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è)" class="w-full border rounded px-3 py-2">

    <button type="submit" class="btn-secondary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</form>

{% if question_success %}
<div class="text-green-600 mt-2 text-sm">‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π –≤–æ–ø—Ä–æ—Å –æ–±–Ω–æ–≤–ª—ë–Ω</div>
{% endif %}
{% endblock %}
